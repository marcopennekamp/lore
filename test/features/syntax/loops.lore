use lore.number.to_real

func divide_by_2(a: Int, b: Int): Real = do
  let mut r = to_real(a)
  while r > b yield r /= 2
  r
end

func repeat(v: Int, n: Int): [Int] = do
  let mut i = 0
  while i < n
    i += 1
    v
  end
end

func increment_all(values: [Int]): [Int] = for v <- values yield v + 1

func add_pairs(as: [Int], bs: [Int]): [Int] = do
  for a <- as, b <- bs
    a + b
  end
end

// This ensures that extractor variables and collections are correctly scoped.
func scoped_extractors(xs: [[Int]]): [Int] = for xs <- xs, xs <- xs yield xs

func test(): [[Real] | [Int]] = do
  [
    [
      divide_by_2(10, 20),
      divide_by_2(40, 20),
      divide_by_2(234, 45),
    ],
    repeat(15, 3),
    increment_all([10, 3, 40, -2, 15]),
    add_pairs([1, 2], [3, 4]),
    scoped_extractors([[1, 2], [3, 4]]),
  ]
end
