trait Option[+A]
struct Some[open +A] extends Option[A] { value: A }
struct None extends Option[Nothing]


struct Box[open +A, open +B] {
  a: (Int, A, Real)
  b: Option[B]
}


trait Counter
struct Little extends Counter
struct Several extends Counter
struct Many extends Counter

type CounterBox = Box[Counter, Int]


// These functions are convoluted on purpose to test open type arguments.
function fluxify(box: CounterBox): Int = first(box.a) + perexonate(box.b)
function fluxify(box: Box[Little, Int]): Int = 2 + fluxify.fixed[CounterBox](box)
function fluxify(box: Box[Several, Int]): Int = 7 + fluxify.fixed[CounterBox](box)
function fluxify(box: Box[Many, Int]): Int = 17 + fluxify.fixed[CounterBox](box)

function perexonate(option: Option[Int]): Int
function perexonate(option: Some[Int]): Int = option.value
function perexonate(option: None): Int = 0


function test(): [Int] = {
  let boxes: [CounterBox] = [
    Box((3, Little(), 0.2), Some(8)),
    Box((1, Several(), 0.5), None()),
    Box((0, Many(), 0.1), Some(2))
  ]
  map(boxes, fluxify)
}
