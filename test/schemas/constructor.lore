use lore.core.to_string
use lore.Enum.map

trait Content
object Cereal() extends Content
object Blood() extends Content
object Pudding() extends Content

module lore.core do
  func to_string(Cereal): String = 'cereal'
  func to_string(Blood): String = 'blood'
  func to_string(Pudding): String = 'pudding'
end


trait Container[+C]

struct Bowl[+C <: Content] extends Container[C]
  content: C
  taste: Int
end

struct Cup[+C <: Content] extends Container[C]
  content: C
  exclusivity: Int
end

module lore.core do
  func to_string(bowl: Bowl[Content]): String = '${bowl.content} bowl'
  func to_string(cup: Cup[Content]): String = '${cup.content} cup'
end

func cereal(container: (Cereal, Int) => A): A where A = container(Cereal, 4)
func blood(container: (Blood, Int) => A): A where A = container(Blood, 1)
func pudding(container: (Pudding, Int) => A): A where A = container(Pudding, 9)


func test(): [String] = do
  let containers = [
    cereal(Bowl), cereal(Cup),
    blood(Bowl), blood(Cup),
    pudding(Bowl), pudding(Cup),
  ]
  containers |> map(to_string)
end
