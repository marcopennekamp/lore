trait Array[+A]

func at(Array[A], index: Int): A where A
func prepend(Array[A], element: E): Unit where A, E <: A
func append(Array[A], element: E): Unit where A, E <: A
func removeFirst(Array[A]): Unit where A
func removeLast(Array[A]): Unit where A


struct NaiveArray[A] extends Array[A] {
  mut underlying: [A]
}

// TODO: Given these functions, the compiler should not allow `NaiveArray` to extend a covariant `Array[A]`. But can we
//       deduce this? Right now, trying to add a Real to a NaiveArray[Int] via an Array[Real] interface leads to a
//       run-time error. This is acceptable, but might not be good enough.
func at(array: NaiveArray[A], index: Int): A where A = get(array.underlying, index)

func prepend(array: NaiveArray[A], element: E): Unit where A, E <: A = {
  array.underlying = concat([element], array.underlying)
}

func append(array: NaiveArray[A], element: E): Unit where A, E <: A = {
  array.underlying = array.underlying :+ element
}

func removeFirst(array: NaiveArray[A]): Unit where A = {
  array.underlying = tail(array.underlying)
}

func removeLast(array: NaiveArray[A]): Unit where A = {
  array.underlying = init(array.underlying)
}


func test(): [Int] = {
  let array = NaiveArray([1, 2])
  append(array, 3)
  append(array, 4)
  append(array, 5)
  prepend(array, 0)
  removeLast(array)
  removeFirst(array)
  removeFirst(array)
  array.underlying
}
